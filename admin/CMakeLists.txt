# Copy template files into <build_dir>/local_init
set(WORKER_CONFIG_DIR "${CMAKE_BINARY_DIR}/local_init")
file(MAKE_DIRECTORY ${WORKER_CONFIG_DIR})
if(${BUILD_TESTS})
    configure_file("worker_4tests.m.template" "${WORKER_CONFIG_DIR}/worker_4tests.m")
endif()
configure_file("worker_v2.m.template" "${WORKER_CONFIG_DIR}/worker_v2.m")

set(_path_regex "[a-zA-Z0-9/\\\\_\\-\\.: ]+")

file(READ "herbert_on.m.template" _herbert_on_template)
string(REGEX REPLACE
    "default_herbert_path ?= ?'${_path_regex}'"
    "default_herbert_path = '${CMAKE_SOURCE_DIR}/herbert_core'"
    _herbert_on_script
    "${_herbert_on_template}"
)
file(WRITE "${WORKER_CONFIG_DIR}/herbert_on.m" "${_herbert_on_script}")

set(Herbert_AUTO_GENERATED_FILE_WARNING
    "This file is auto-generated by CMake. Do not edit, any edits may be lost.")
# Configure the herbert_version.m script. The template script is copied into
# herbert_core/admin and CMake's project version formmatted into it. This
# provides the function with an up-to-date version number for every build.
configure_file("herbert_get_build_version.m.template"
               "${CMAKE_SOURCE_DIR}/herbert_core/admin/herbert_get_build_version.m")

# Configure the version.h header. The template is copied into _LowLevelCode/CPP
# and defines macro VERSION with CMake's project version.
configure_file("version.h.template"
               "${CMAKE_SOURCE_DIR}/_LowLevelCode/CPP/utility/version.h")

# =============================================================================
# Install commands
# =============================================================================
install(
    FILES
        "herbert_on.m.template"
        "herbert_root.m"  # required by validate_herbert
        "validate_herbert.m"
        "worker_4tests.m.template"
        "worker_v2.m.template"
    DESTINATION "Herbert/admin/"
)
